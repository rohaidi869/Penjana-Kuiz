<script>
    // Definisi pemboleh ubah global
    const quizProgrammeName = "Diploma Bahasa Arab"; // Ditakrifkan untuk digunakan dalam sendExampleWhatsApp()

    // Fungsi untuk tab navigation
    function switchTab(tabName) {
        // Alih kelas 'active' dari semua tab
        document.querySelectorAll('.tab').forEach(tab => {
            tab.classList.remove('active');
        });

        // Sembunyikan semua kandungan tab
        document.querySelectorAll('.tab-content').forEach(content => {
            content.style.display = 'none';
        });

        // Tetapkan kelas 'active' dan paparkan kandungan tab yang dipilih
        document.querySelector(`.tab[onclick="switchTab('${tabName}')"]`).classList.add('active');
        const activeContent = document.getElementById(tabName);
        activeContent.style.display = 'block';

        // Reset kuiz jika tab 'quiz' dipilih
        if (tabName === 'quiz') {
            resetQuiz();
        }
    }

    // Fungsi untuk reset contoh kuiz
    function resetQuiz() {
        document.getElementById('quiz-start-container').style.display = 'block';
        document.getElementById('quiz-quiz-container').style.display = 'none';
        document.getElementById('quiz-certificate').style.display = 'none';
        document.getElementById('quiz-studentName').value = '';
    }

    // Fungsi untuk memainkan bunyi klik
    function playClickSound() {
        const audio = new Audio('https://freesound.org/data/previews/171/171671_2437358-lq.mp3');
        audio.play().catch(() => {});
    }

    // Fungsi untuk memainkan bunyi jawapan betul
    function playCorrectSound() {
        const audio = new Audio('https://freesound.org/data/previews/320/320181_5260875-lq.mp3');
        audio.play().catch(() => {});
    }

    // Fungsi untuk memainkan bunyi jawapan salah
    function playWrongSound() {
        const audio = new Audio('https://freesound.org/data/previews/256/256113_3263906-lq.mp3');
        audio.play().catch(() => {});
    }

    // ===== FUNGSI PENJANA PROMPT =====
    function hasilkanPrompt() {
        playClickSound();

        // Dapatkan nilai input
        const Program = document.getElementById('Program').value.trim();
        const Kursus = document.getElementById('Kursus').value.trim();
        let jumlah = document.getElementById('jumlah').value.trim();
        const bahasa = document.getElementById('bahasa').value;
        let topik = document.getElementById('topik').value.trim();
        const guruPhone = document.getElementById('guru-phone').value.trim();
        const googleScript = document.getElementById('google-script').value.trim();

        // Validasi input wajib
        if (!Program) {
            alert("Sila masukkan nama Program!");
            document.getElementById('Program').focus();
            return;
        }

        if (!Kursus) {
            alert("Sila masukkan nama kursus!");
            document.getElementById('Kursus').focus();
            return;
        }

        // Tampilkan loading
        document.getElementById('loading').style.display = 'block';

        // Jika jumlah kosong, guna 10
        if (jumlah === '') {
            jumlah = '10';
        }

        // Jika topik kosong, guna Kursus
        if (topik === '') {
            topik = Kursus;
        }

        // Peta kod bahasa
        const bahasaMap = {
            "AR": "Arab",
            "BM": "Bahasa Melayu",
            "BI": "Bahasa Inggeris"
        };

        // Format nombor WhatsApp (tanpa prefix)
        const formattedPhone = guruPhone;

        // Generate quizData example based on 'jumlah'
        let quizDataExample = `    {
        question: "Soalan 1 untuk topik ${topik} dalam ${bahasaMap[bahasa]}?",
        options: ["Pilihan A", "Pilihan B", "Pilihan C", "Pilihan D"],
        answer: "Pilihan A",
        explanation: "Penjelasan jawapan untuk soalan 1."
    }`;
        for (let i = 2; i <= parseInt(jumlah); i++) {
            quizDataExample += `,
    {
        question: "Soalan ${i} untuk topik ${topik} dalam ${bahasaMap[bahasa]}?",
        options: ["Pilihan A", "Pilihan B", "Pilihan C", "Pilihan D"],
        answer: "Pilihan A",
        explanation: "Penjelasan jawapan untuk soalan ${i}."
    }`;
        }

        // Bina prompt tanpa rujukan logo
        let prompt = `Anda adalah seorang pembangun berpengalaman dalam mencipta sistem kuiz interaktif berasaskan web. Tugas anda ialah membangunkan dan menghasilkan kod HTML lengkap (termasuk CSS dan JavaScript) bagi kuiz interaktif berdasarkan topik bagi Kursus yang diberikan. Kuiz ini bertujuan menilai kefahaman pelajar terhadap topik yang diberi melalui soalan pelbagai aras kesukaran (fakta, aplikasi, analisis), dan menyediakan maklum balas serta gred automatik. Pelajar akan menghantar keputusan mereka kepada pensyarah melalui WhatsApp atau Google Sheet. 

**SPESIFIKASI KUIZ:**
- Program: ${Program}
- Kursus: ${Kursus}
- Topik: ${topik}
- Bahasa: ${bahasaMap[bahasa]}
- Bilangan Soalan: ${jumlah}
- Format: Pilihan berganda (4 pilihan)
- Google Script URL: ${googleScript || 'Tidak disediakan'}

**KEHENDAK FUNGSI:**
1. HTML lengkap dengan CSS dan JavaScript
2. Tiga halaman:
   - Halaman Mula (input nama pelajar dan Arahan Menjawab)
   - Halaman Kuiz (soalan, jawapan dan Keterangan jawapan)
   - Halaman Sijil (paparan gred)
3. Fungsi JavaScript:
   - quizData = array objek soalan
   - startQuiz(), loadQuestion(), checkAnswer()
   - navigasi soalan (sebelum/seterus)
   - sistem gred automatik
   - fungsi hantar melalui WhatsApp
   - fungsi hantar ke Google Sheet
   - paparkan jawapan yang betul dan keterangan bagi jawapan yang betul akan dipaparkan di bawah pilihan jawapan sebelum pelajar berpindah ke soalan seterusnya
   - Mainkan bunyi klik setiap kali pelajar memilih jawapan

**FUNGSI WHATSAPP:**
- Tambah butang "Hantar Jawapan" di halaman sijil
- Butang ini akan membuka WhatsApp dengan nombor guru: ${formattedPhone ? '60' + formattedPhone : '[NOMBOR GURU]'}
- Mesej WhatsApp mengandungi:
  Nama Program: $[Program]
  Nama Pelajar: [nama]
  Kursus: ${Kursus}
  Topik: ${topik}
  Skor: [skor]/[jumlah soalan]
  Gred: [gred]
  Tarikh: [tarikh selesai]

**FUNGSI GOOGLE SHEET:**
- Tambah butang "Hantar ke Google Sheet" di halaman sijil
- Gunakan URL: ${googleScript || '[URL_GOOGLE_SCRIPT]'}
- Data yang dihantar:
  Program: [program]
  Nama: [nama]
  Skor: [skor]
  Gred: [gred]
  Tarikh: [tarikh]

**FUNGSI BUNYI:**
function playClickSound() {
    const audio = new Audio('https://freesound.org/data/previews/171/171671_2437358-lq.mp3');
    audio.play().catch(() => {});
}
function playCorrectSound() {
    const audio = new Audio('https://freesound.org/data/previews/320/320181_5260875-lq.mp3');
    audio.play().catch(() => {});
}
function playWrongSound() {
    const audio = new Audio('https://freesound.org/data/previews/256/256113_3263906-lq.mp3');
    audio.play().catch(() => {});
}

**CONTOH KOD UTAMA:**
function startQuiz() {
    studentName = document.getElementById('studentName').value;
    if (!studentName) return alert("Sila masukkan nama anda");
    document.getElementById('start-container').style.display = 'none';
    document.getElementById('quiz-container').style.display = 'block';
    loadQuestion();
}

function loadQuestion() {
    const q = quizData[currentQuestion];
    document.getElementById('question').innerText = q.question;
    const optionsDiv = document.getElementById('options');
    optionsDiv.innerHTML = '';
    document.getElementById('explanation').innerText = '';
    q.options.forEach(option => {
        const btn = document.createElement('button');
        btn.innerText = option;
        btn.onclick = () => checkAnswer(option);
        optionsDiv.appendChild(btn);
    });
}

function checkAnswer(selected) {
    playClickSound();
    const q = quizData[currentQuestion];
    const isCorrect = selected === q.answer;
    document.getElementById('explanation').innerText = q.explanation;
    if (isCorrect) {
        score++;
        playCorrectSound();
    } else {
        playWrongSound();
    }
}

function nextQuestion() {
    if (currentQuestion < quizData.length - 1) {
        currentQuestion++;
        loadQuestion();
    } else {
        endQuiz();
    }
}

function prevQuestion() {
    if (currentQuestion > 0) {
        currentQuestion--;
        loadQuestion();
    }
}

function endQuiz() {
    document.getElementById('quiz-container').style.display = 'none';
    document.getElementById('certificate').style.display = 'block';
    document.getElementById('certName').innerText = studentName;
    document.getElementById('scoreDisplay').innerText = \`\${score}/\${quizData.length}\`;
    const percent = (score / quizData.length) * 100;
    let grade, motivasi;
    if (percent >= 90) {
        grade = "Cemerlang";
        motivasi = "Tahniah! Anda menunjukkan penguasaan yang sangat baik!";
    } else if (percent >= 70) {
        grade = "Sangat Baik";
        motivasi = "Teruskan usaha anda. Pencapaian anda sangat membanggakan!";
    } else if (percent >= 50) {
        grade = "Lulus";
        motivasi = "Anda lulus, tetapi masih ada ruang untuk penambahbaikan.";
    } else {
        grade = "Perlu Semakan";
        motivasi = "Jangan putus asa! Teruskan ulang kaji dan cuba lagi.";
    }
    document.getElementById('grade').innerText = grade;
    document.getElementById('motivasi').innerText = motivasi;
}

**CONTOH QUIZDATA:**
\`\`\`javascript
const quizData = [
${quizDataExample}
];
\`\`\`

**SISTEM GRED:**
- 90–100%: ممتاز / Cemerlang / Excellent → "Tahniah! Anda menunjukkan penguasaan yang sangat baik!"
- 70–89%: جيد جدا / Sangat Baik / Very Good → "Teruskan usaha anda. Pencapaian anda sangat membanggakan!"
- 50–69%: مقبول / Lulus / Pass → "Anda lulus, tetapi masih ada ruang untuk penambahbaikan."
- <50%: يحتاج إلى المراجعة / Perlu Semakan / Needs Review → "Jangan putus asa! Teruskan ulang kaji dan cuba lagi."

**ARAHAN TAMBAHAN:**
1. Pastikan UI responsif menggunakan CSS Flexbox/Grid
2. Gunakan font Google 'Cairo' untuk semua teks
3. Tambahkan efek hover pada butang
4. Sertakan komen dalam kod untuk penjelasan fungsi penting
5. Tambahkan fungsi hantar melalui WhatsApp dan Google Sheet seperti yang ditetapkan
6. Hasilkan jumlah soalan seperti yang dipinta
7. Pastikan paparan jawapan yang betul dan keterangan bagi jawapan yang betul akan dipaparkan di bawah pilihan jawapan sebelum pelajar berpindah ke soalan seterusnya
8. Fungsi bunyi mesti dipanggil setiap kali pelajar klik mana-mana pilihan
9. Gunakan warna tema profesional (biru dan hijau)
10. Sertakan butang navigasi (sebelum/seterus) yang jelas
`;

        // Paparkan output setelah 1.5s (simulasi proses)
        setTimeout(() => {
            const promptContent = document.getElementById('prompt-content');
            promptContent.textContent = prompt;

            const outputDiv = document.getElementById('output');
            outputDiv.style.display = 'block';

            document.getElementById('loading').style.display = 'none';

            // Tampilkan butang WhatsApp jika nombor diisi
            if (formattedPhone) {
                document.getElementById('whatsapp-btn').style.display = 'flex';
            }
        }, 1500);
    }

    // Fungsi untuk menyalin prompt
    document.getElementById('copy-btn').addEventListener('click', () => {
        playClickSound();
        const promptContent = document.getElementById('prompt-content').textContent;
        navigator.clipboard.writeText(promptContent)
            .then(() => {
                alert('Prompt telah disalin ke clipboard!');
            })
            .catch(err => {
                console.error('Gagal menyalin: ', err);
                alert('Gagal menyalin. Sila cuba lagi.');
            });
    });

    // Fungsi untuk hantar melalui WhatsApp
    document.getElementById('whatsapp-btn').addEventListener('click', () => {
        playClickSound();
        const guruPhone = document.getElementById('guru-phone').value.trim();
        const Kursus = document.getElementById('Kursus').value.trim();

        if (!guruPhone) {
            alert("Sila masukkan nombor WhatsApp guru terlebih dahulu!");
            return;
        }

        const formattedPhone = `60${guruPhone}`;
        const promptContent = document.getElementById('prompt-content').textContent;

        const whatsappMessage = encodeURIComponent(
            `*Permintaan Penjana Kuiz*\n\n` +
            `Kursus: ${Kursus}\n` +
            `Prompt Kuiz telah dijana. Sila lihat di bawah:\n\n${promptContent}`
        );

        const whatsappUrl = `https://wa.me/${formattedPhone}?text=${whatsappMessage}`;
        window.open(whatsappUrl, '_blank');
    });

    // Format automatik untuk input telefon (hanya angka)
    document.getElementById('guru-phone').addEventListener('input', function(e) {
        e.target.value = e.target.value.replace(/\D/g, '');
    });

    // ===== KOD UNTUK CONTOH KUIZ =====
    const quizData = [
        {
            question: "Apakah definisi psikolinguistik yang paling tepat?",
            options: [
                "Kajian tentang hubungan antara bahasa dan budaya",
                "Kajian tentang struktur bahasa formal",
                "Kajian tentang proses mental dalam pemerolehan dan penggunaan bahasa",
                "Kajian tentang sejarah perkembangan bahasa"
            ],
            answer: "Kajian tentang proses mental dalam pemerolehan dan penggunaan bahasa",
            explanation: "Psikolinguistik adalah bidang interdisipliner yang mengkaji proses kognitif dan mental yang terlibat dalam pemerolehan, pemahaman, dan penghasilan bahasa."
        },
        {
            question: "Teori mana yang mencadangkan bahawa manusia dilahirkan dengan kebolehan semula jadi untuk mempelajari bahasa?",
            options: [
                "Teori Behavioris",
                "Teori Interaksionis",
                "Teori Nativis",
                "Teori Kognitif"
            ],
            answer: "Teori Nativis",
            explanation: "Teori Nativis yang diusulkan oleh Noam Chomsky mencadangkan bahawa manusia mempunyai peranti pemerolehan bahasa (LAD) yang semula jadi."
        },
        {
            question: "Apakah yang dimaksudkan dengan 'pemerolehan bahasa'?",
            options: [
                "Proses pembelajaran bahasa secara formal di sekolah",
                "Proses semula jadi penguasaan bahasa tanpa pengajaran formal",
                "Kajian tentang sejarah perkembangan bahasa",
                "Teknik mengajar bahasa kedua"
            ],
            answer: "Proses semula jadi penguasaan bahasa tanpa pengajaran formal",
            explanation: "Pemerolehan bahasa merujuk kepada proses semula jadi di mana kanak-kanak mempelajari bahasa ibunda mereka tanpa pengajaran formal."
        },
        {
            question: "Faktor utama yang mempengaruhi pemerolehan bahasa kedua ialah:",
            options: [
                "Umur, motivasi, dan pendedahan bahasa",
                "Jantina, bangsa, dan agama",
                "Status sosioekonomi dan lokasi geografi",
                "Semua di atas"
            ],
            answer: "Umur, motivasi, dan pendedahan bahasa",
            explanation: "Kajian menunjukkan umur, motivasi, dan pendedahan bahasa adalah faktor utama yang mempengaruhi kejayaan pemerolehan bahasa kedua."
        },
        {
            question: "Apakah perbezaan utama antara pemerolehan bahasa pertama dan kedua?",
            options: [
                "Pemerolehan bahasa pertama lebih cepat daripada kedua",
                "Pemerolehan bahasa pertama berlaku secara semula jadi, manakala kedua memerlukan pengajaran formal",
                "Tidak ada perbezaan yang ketara",
                "Pemerolehan bahasa kedua hanya berlaku pada kanak-kanak"
            ],
            answer: "Pemerolehan bahasa pertama berlaku secara semula jadi, manakala kedua memerlukan pengajaran formal",
            explanation: "Pemerolehan bahasa pertama berlaku secara semula jadi dalam persekitaran bahasa, manakala pemerolehan bahasa kedua biasanya melibatkan pembelajaran secara sedar dan pengajaran formal."
        }
    ];

    let currentQuizQuestion = 0;
    let quizScore = 0;
    let quizStudentName = '';

    function startExampleQuiz() {
        quizStudentName = document.getElementById('quiz-studentName').value;
        if (!quizStudentName) {
            alert("Sila masukkan nama anda");
            return;
        }
        document.getElementById('quiz-start-container').style.display = 'none';
        document.getElementById('quiz-quiz-container').style.display = 'block';
        currentQuizQuestion = 0;
        quizScore = 0;
        document.getElementById('total-questions').textContent = quizData.length;
        loadQuizQuestion();
    }

    function loadQuizQuestion() {
        const q = quizData[currentQuizQuestion];
        document.getElementById('current-question-num').textContent = currentQuizQuestion + 1;
        document.getElementById('quiz-question').innerText = q.question;
        const optionsDiv = document.getElementById('quiz-options');
        optionsDiv.innerHTML = '';
        document.getElementById('quiz-explanation').innerText = '';

        q.options.forEach(option => {
            const btn = document.createElement('button');
            btn.innerText = option;
            btn.onclick = () => checkQuizAnswer(option);
            optionsDiv.appendChild(btn);
        });
    }

    function checkQuizAnswer(selected) {
        playClickSound();
        const q = quizData[currentQuizQuestion];
        const isCorrect = selected === q.answer;
        document.getElementById('quiz-explanation').innerText = isCorrect 
            ? "✔ Jawapan Betul! " + q.explanation 
            : "✘ Jawapan Salah. " + q.explanation;

        if (isCorrect) {
            quizScore++;
            playCorrectSound();
        } else {
            playWrongSound();
        }
    }

    function nextQuizQuestion() {
        if (currentQuizQuestion < quizData.length - 1) {
            currentQuizQuestion++;
            loadQuizQuestion();
        } else {
            endExampleQuiz();
        }
    }

    function prevQuizQuestion() {
        if (currentQuizQuestion > 0) {
            currentQuizQuestion--;
            loadQuizQuestion();
        }
    }

    function endExampleQuiz() {
        document.getElementById('quiz-quiz-container').style.display = 'none';
        document.getElementById('quiz-certificate').style.display = 'block';
        document.getElementById('quiz-certName').innerText = quizStudentName;
        document.getElementById('quiz-scoreDisplay').innerText = `${quizScore}/${quizData.length}`;

        const percent = (quizScore / quizData.length) * 100;
        let grade, motivasi;

        if (percent >= 90) {
            grade = "Cemerlang";
            motivasi = "Tahniah! Anda menunjukkan penguasaan yang sangat baik!";
        } else if (percent >= 70) {
            grade = "Sangat Baik";
            motivasi = "Teruskan usaha anda. Pencapaian anda sangat membanggakan!";
        } else if (percent >= 50) {
            grade = "Lulus";
            motivasi = "Anda lulus, tetapi masih ada ruang untuk penambahbaikan.";
        } else {
            grade = "Perlu Semakan";
            motivasi = "Jangan putus asa! Teruskan ulang kaji dan cuba lagi.";
        }

        document.getElementById('quiz-grade').innerText = grade;
        document.getElementById('quiz-motivasi').innerText = motivasi;
    }

    function sendExampleWhatsApp() {
        const guruPhone = document.getElementById('guru-phone').value.trim();
        if (!guruPhone) {
            alert("Sila masukkan nombor guru dalam penjana terlebih dahulu");
            return;
        }

        const phone = `60${guruPhone}`;
        const msg = encodeURIComponent(
            `Nama Program: ${quizProgrammeName}\n` +
            `Nama Pelajar: ${quizStudentName}\n` +
            `Kursus: Psikolinguistik\n` +
            `Topik: Pemerolehan Bahasa Kedua\n` +
            `Skor: ${quizScore}/${quizData.length}\n` +
            `Gred: ${document.getElementById('quiz-grade').innerText}\n` +
            `Tarikh: ${new Date().toLocaleDateString()}`
        );
        window.open(`https://wa.me/${phone}?text=${msg}`, '_blank');
    }

    function sendExampleToGoogleSheet() {
        const googleScript = document.getElementById('google-script').value.trim();
        if (!googleScript) {
            alert("Sila masukkan URL Google Script dalam penjana");
            return;
        }

        const data = { 
            program: quizProgrammeName,
            name: quizStudentName,
            score: quizScore,
            grade: document.getElementById('quiz-grade').innerText,
            date: new Date().toLocaleDateString(),
            course: "Psikolinguistik",
            topic: "Pemerolehan Bahasa Kedua"
        };

        fetch(googleScript, {
            method: 'POST',
            mode: 'no-cors',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        }).then(() => alert('Data dihantar ke Google Sheet'));
    }
</script>
